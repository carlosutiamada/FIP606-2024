{"title":"Regressão","markdown":{"yaml":{"title":"Regressão","format":"html","message":false,"warning":false},"headingText":"Pacotes","containsRefs":false,"markdown":"\n\n\n```{r}\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(car)\n```\n\n# Regressão linear\n\nA regressão é uma técnica estatística utilizada para modelar e analisar a relação entre uma variável dependente (ou resposta) e uma ou mais variáveis independentes (ou preditoras). O objetivo principal da regressão é entender como a variável dependente varia quando as variáveis independentes mudam e usar essa compreensão para fazer previsões.\n\n## Importação dos dados\n\nO conjunto de dados foi importado a partir do Google Sheet através da função `gsheet2tbl()` do pacote `gsheet`. \n\nEsse conjunto de dados é composto pelo *trat*, que é o percentual de sementes inoculados com patógenos e *nplants*, que é o número de plantas emergidas no campo. Estima-se que o aumento da concentração de inóculo irá diminuir a estande de plantas no cmapo. O fator de concentração de inóculo é um fator numérico contínuo.\n\n```{r}\nlibrary(gsheet)\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n## Visualização dos dados\n\nForam criados gráficos de pontos com intervalos de confiança. Os gráficos foram criados usando as funções `ggplot()`, `geom_jitter()` e `stat_summary` (para criar os pontos médios e intervalos de confiança). \n\nTambém foi usada a função `geom_smooth()` com o argumento `method = \"lm\"` para criar uma linha de tendência no gráfico ajustado ao modelo linear, mostrando a tendência que os dados possuem de aumentar ou diminuir em função do eixo X.\n\n```{r}\nestande |> \n  ggplot(aes(trat, nplants))+\n  geom_jitter(width = 0.1, color = \"gray\")+\n  facet_wrap(~exp)+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"blue\")+\n  geom_smooth(method = \"lm\", se = F)\n\nestande |> \n  ggplot(aes(trat, nplants, color = factor(exp)))+\n  geom_jitter(width = 0.1, color = \"gray\")+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"blue\")+\n  geom_smooth(method = \"lm\", se = F)\n```\n\n## Regressão linear do experimento 1\n\nInicialmente foi filtrado apenas o experimento 1 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp1 <- estande |> \n  filter(exp == 1)\n```\n\nDepois foi plotado um gráfico do experimento 1 usando as funções `ggplot()`, `geom_point()` e `geom_smooth()` (dessa vez sem nenhum ajuste de modelo).\n\n```{r}\nexp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F)\n```\n\nPode-se observar pelo gráfico que a linha de tendência se assemelha a uma reta (modelo linear).\n\nPara ajustar os dados em um modelo linear, foi usada a função `lm()`.\n\n```{r}\nlm1 <- lm(nplants ~ trat,\n          data = exp1)\nsummary(lm1)\n```\n\nA partir da função `summary()`, é possível inferir que a taxa de redução da variável resposta em função do eixo X é de -0.24, ou seja, para cada unidade de X reduz o Y em -0.24.\n\nAlém disso, o p-valor é informado, sendo igual a 0.2066, ou seja, é superior ao nível de significância e não se pode rejeitar a hipótese nula (Ho: a taxa de redução é igual a 0).\n\nOutra alternativa para realizar a regressão linear é usando a função `glm()` e o argumento `family = \"gaussian\"`.\n\n```{r}\nglm1 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp1)\nsummary(glm1)\n```\n\nA família gaussiana envolve o mesmo método do \"lm\", resultando na mesma taxa de redução.\n\n## Regressão linear do experimento 2\n\nInicialmente foi filtrado apenas o experimento 2 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp2 <- estande |> \n  filter (exp == 2)\n```\n\nO mesmo gráfico foi montado para o experimento 2.\n\n```{r}\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = F)\n```\n\nPelo gráfico é possível observar uma diminuição dos valores de Y em função do eixo X.\n\n```{r}\nlm2 <- lm(nplants ~ trat,\n          data = exp2)\nsummary(lm2)\n```\n\nO resultado do modelo linear indica que a taxa de redução desses dados é de -0.70, ou seja, para cada unidade de X reduz o Y em -0.70.\n\nNesse experimento nota-se que o p-valor foi inferior ao nível de significância, indicando que a hipótese nula de que a taxa de redução é igual a 0 é rejeitada, ou seja, há uma regressão.\n\nAjustando o modelo pelo método do GLM, pode ser utilizado duas famílias: `family = \"gaussian\"` e `family = \"log\"`.\n\n```{r}\nglm2 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp2)\nsummary(glm2)\nAIC(glm2)\n\nglm2b <- glm(nplants ~ trat,\n             family = poisson(link = \"log\"),\n             data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n```\n\nA função `AIC()` compara os dois métodos (famílias diferentes) e fornece qual deles melhor representa o conjunto de dados. Sempre o menor valor é o mais recomendado. Nesse caso, usando a família gaussiana, o valor de AIC foi menor, sendo o modelo que melhor representa os dados.\n\n## Regressão linear do experimento 3\n\nInicialmente foi filtrado apenas o experimento 3 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp3 <- estande |> \n  filter (exp == 3)\n```\n\nO mesmo gráfico foi montado para o experimento 3.\n\n```{r}\nexp3 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = F)\n```\n\nPelo gráfico é possível observar uma diminuição dos valores de Y em função do eixo X.\n\n```{r}\nlm3 <- lm(nplants ~ trat,\n          data = exp3)\nsummary(lm3)\n```\n\nO resultado do modelo linear indica que a taxa de redução desses dados é de -0.76, ou seja, para cada unidade de X reduz o Y em -0.76.\n\nNesse experimento nota-se que o p-valor foi inferior ao nível de significância, indicando que a hipótese nula de que a taxa de redução é igual a 0 é rejeitada, ou seja, há uma regressão.\n\nO coeficiente de determinação (adjusted R-squared) fornecido é igual a 59%, o que indica que 59% da variabilidade do Y (número de plantas) é explicado pelo X (inóculo), sendo o máximo desse coeficiente igual a 1.\n\n```{r}\nglm3 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp3)\nsummary(glm3)\nAIC(glm3)\n\nglm3b <- glm(nplants ~ trat,\n             family = poisson(link = \"log\"),\n             data = exp3)\nsummary(glm3b)\nAIC(glm3b) #melhor qualidade de ajuste, quanto menor é melhor (mais ajustado)\n```\n\nPara esse conjunto de dados, a família log resultou em um menor valor de AIC, o que indica que esse modelo melhor representa os dados que a família gaussiana.\n\nTransformando o log dos tratamentos, os dados ficam mais linearizados (diminui a curva).\n\n```{r}\nexp3 |> \n  ggplot(aes(log(trat), nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F)\n```\n\n## Regressão linear geral\n\nPegandos os dados inteiros, foi realizado o ajuste do modelo usando o GLM tanto com a família gaussianda quanto por log e depois foi comparado os dois modelos com o AIC.\n\n```{r}\nlibrary(lme4)\nglm4 <- glmer(nplants ~ trat + (trat|exp),\n            family = \"gaussian\",\n            data = estande)\nsummary(glm4)\nAIC(glm4)\n\nglm4b <- glmer(nplants ~ trat + (trat|exp),   #(trat|exp) é o efeito aleatório\n             family = poisson(link = \"log\"),\n             data = estande)\nsummary(glm4b)\nAIC(glm4b)\n```\n\nUsando a família gaussianda, nota-se que o AIC obtido foi menor, indicando que, no geral, esse modelo é o que melhor representa o conjunto de dados.\n\n# Regressão linear - conjunto de dados 2\n\nPara uma nova regressão linear, um novo conjunto de dados foi importado a partir do pacote `r4pde`. O conjunto de dados é denominado de WhiteMoldSoybean.\n\nA regressão linear será usada para prever a produtividade da soja em função da incidência do mofo branco.\n\n```{r}\nlibrary(r4pde)\n\nwm <- WhiteMoldSoybean\n```\n\n## Visualização dos dados\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld, group = factor(study)))+\n  geom_point()+\n  facet_wrap(~ study)+\n  geom_smooth(method = \"lm\", se = F)+\n  theme_minimal()\n```\n\n## Regressão linear\n\n```{r}\nmofo1 <- lm(yld ~ inc,\n            data = wm)\nsummary(mofo1)\n```\n\nAjustando o conjunto de dados ao modelo linear, foi obtido uma taxa de redução de -9.261.\n\n```{r}\nlibrary(broom)\nmofo2 <- wm |> \n  group_by(study) |> \n  do(tidy(lm(.$yld ~ .$inc), conf.int = TRUE))\n\ndf<- mofo2 |> \n  filter(term == \".$inc\")\nmean(df$estimate)\n\n#Histograma da produtividade quando incidência é 0\np1 <- mofo2 |> \n  filter(term == \"(Intercept)\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Intercept\", y = \"frequency\")\np2 <- mofo2 |> \n  filter(term == \".$inc\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Slopes\", y = \"frequency\")\nlibrary(patchwork)\np1+p2\n```\n\nUm outro ajuste de modelo foi utilizado para o conjunto de dados, considerando desa vez um efeito aleatório de incidência por estudos.\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld ~ inc + (inc|study), data = wm, REML = F)\nsummary(mofo3)\n```\nEsta estimativa de taxa de redução de -17 é muito mais confiável, uma vez que os outros métodos subestimam os valores.\n\nA incidência está causando uma redução na produtividade de -17kg (à medida que a incidência aumenta, a produtividade diminui em 17kg)\n\n```{r}\nAnova(mofo3)\nconfint(mofo3, method = \"Wald\")\n```\n\n# Regressão quadrática\n\nA regressão quadrática é usada em modelos quadráticos, ou seja, modelos de segundo grau. Ao invés de regressões lineares, esses modelos formam regressões curvi-lineares.\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\nA partir do gráfico importado, foi filtrado apenas o experimento 2 para realizar a regressão quadrática.\n\n```{r}\nexp2 <- estande |> \n  filter (exp == 2)\n```\n\n## Visualização dos dados\n\nO gráfico montado apresenta tanto a linha de tendência ajustada no modelo linear quanto a linha de tendência ajustada no modelo quadrático, usando a função `geom_smooth()` e o argumento `formula = y ~poly(x,2)`.\n\n```{r}\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = FALSE,\n              formula = y ~poly(x,2))+ #Modelo quadrático\n  geom_smooth(method = lm, se = F, color = \"red\") #Modelo linear\n```\n\n## Regressão\n\nPara comparar qual é o melhor ajuste de modelo que representa o conjunto de dados, foi realizado o modelo de primeira ordem e de segunda ordem e depois eles foram comparados usando a função `AIC()`.\n\n```{r}\nexp2$trat2 <- exp2$trat^2 #Foi elevado ao quadrado para realizar o modelo quadrático, adicionar um coeficiente\n\n\n#Primeira ordem\nlm2 <- lm(nplants ~ trat,\n          data = exp2)\nsummary(lm2)\n\n#Segunda ordem ou quadrático\nlm3 <- lm(nplants ~ trat + trat2,\n          data = exp2)\nsummary(lm3) #R deu 0.49 --> explica melhor a variação dos dados se comparado ao de primeira ordem\n\nAIC(lm2)\nAIC(lm3)\n```\n\nPelo valor do AIC, observa-se que o modelo quadrático melhor representa o conjunto de dados.\n\nPara formular a função do modelo quadrático, é preciso observar os valores informados no `summary()`\n\n```{r}\nsummary(lm3)\n```\n\nA função do modelo quadrático é y = 66,3 - 1,77xtrat + 0,02xtrat^2\n\n## Usando o pacote AgroR\n\nAtravés do pacote `AgroR`, é possível criar os modelos de maneira mais fácil usando a função `polynomial()` e especificando o grau do modelo.\n\n```{r}\nlibrary(AgroR)\n\nwith(exp2, polynomial(trat, nplants, grau = 1))\n\nwith(exp2, polynomial(trat, nplants, grau = 2))\n\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\nNormalmente não se utiliza o modelo de grau 3, pois não dá para explicar biologicamente a razão do dado estar aumentando e diminuindo.\n\n# Regressão não-linear\n\nQuando não é possível ajustar o conjunto de dados em um modelo linear ou quadrático, tem-se a regressão não-linear.\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n```\n\nO conjunto de dados importado acima tem duas replicatas para cada nível de fator, para que facilite a sua análise, será agrupado as replicatas em um único dado, pegando a média deles.\n\n```{r}\npyra2 <- pyra |> \n  group_by(code, state, dose) |> \n  summarise(mean_germination = mean(germination))\n``` \n\n## Visualização dos dados\n\n```{r}\npyra2 |> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  geom_smooth(span = 3, se = FALSE)+\n  facet_wrap(~code)\n```\n\nNota-se que o conjunto de dados não segue o modelo linear e nem o modelo quadrático.\n\n## Calculando EC50 (redução da germinação em 50%)\n\nComo o conjunto de dados envolve a aplicação de produto em diferentes doses para o controle de germinação do fungo, é possível calcular o EC50, ou seja, a dose em que a redução da germinação é de 50%. Para isso foi usado o pacote `drc` e a função `ED()`. Todavia, antes de se calcular a EC50, é preciso ajustar o conjunto de dados em um modelo não-linear, usando a função `drm()` e o argumento `fct = LL.3()` (log-logistic de 3 parâmetros).\n\n```{r}\nlibrary(drc)\n\nisolado165 <- pyra2 |> \n  filter(code == \"165\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado165,\n            fct = LL.3())\nAIC(drc1) \nplot(drc1) #Para visualizar se o ajuste está bom\nED(drc1, 50, interval = \"delta\") #O interval = delta fornece o intervalo de confiança\n```\n\nPara o isolado 165, estima-se o EC50 no valor de dose 0.55\n\nÉ possível estimar o EC50 de mais de um isolado ao mesmo tempo usando o pacote `ec50estimator` e a função `estimate_EC50()`. Novamente foi usado o argumento `fct = drc::LL.3()`.\n\n```{r}\nlibrary(ec50estimator)\n\ndf_ec50 <- estimate_EC50(mean_germination ~ dose,\n                         data = pyra2,\n                         isolate_col = \"code\",\n                         interval = \"delta\",\n                         fct = drc::LL.3())\ndf_ec50\n```\n\nPode-se também criar um gráfico que permite visualizar quais isolados são mais sensíveis e quais são menos sensíveis ao produto.\n\n```{r}\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  geom_errorbar(aes(ymin = Lower, ymax = Upper))+\n  coord_flip()\n```\n","srcMarkdownNoYaml":"\n\n# Pacotes\n\n```{r}\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(car)\n```\n\n# Regressão linear\n\nA regressão é uma técnica estatística utilizada para modelar e analisar a relação entre uma variável dependente (ou resposta) e uma ou mais variáveis independentes (ou preditoras). O objetivo principal da regressão é entender como a variável dependente varia quando as variáveis independentes mudam e usar essa compreensão para fazer previsões.\n\n## Importação dos dados\n\nO conjunto de dados foi importado a partir do Google Sheet através da função `gsheet2tbl()` do pacote `gsheet`. \n\nEsse conjunto de dados é composto pelo *trat*, que é o percentual de sementes inoculados com patógenos e *nplants*, que é o número de plantas emergidas no campo. Estima-se que o aumento da concentração de inóculo irá diminuir a estande de plantas no cmapo. O fator de concentração de inóculo é um fator numérico contínuo.\n\n```{r}\nlibrary(gsheet)\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n## Visualização dos dados\n\nForam criados gráficos de pontos com intervalos de confiança. Os gráficos foram criados usando as funções `ggplot()`, `geom_jitter()` e `stat_summary` (para criar os pontos médios e intervalos de confiança). \n\nTambém foi usada a função `geom_smooth()` com o argumento `method = \"lm\"` para criar uma linha de tendência no gráfico ajustado ao modelo linear, mostrando a tendência que os dados possuem de aumentar ou diminuir em função do eixo X.\n\n```{r}\nestande |> \n  ggplot(aes(trat, nplants))+\n  geom_jitter(width = 0.1, color = \"gray\")+\n  facet_wrap(~exp)+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"blue\")+\n  geom_smooth(method = \"lm\", se = F)\n\nestande |> \n  ggplot(aes(trat, nplants, color = factor(exp)))+\n  geom_jitter(width = 0.1, color = \"gray\")+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"blue\")+\n  geom_smooth(method = \"lm\", se = F)\n```\n\n## Regressão linear do experimento 1\n\nInicialmente foi filtrado apenas o experimento 1 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp1 <- estande |> \n  filter(exp == 1)\n```\n\nDepois foi plotado um gráfico do experimento 1 usando as funções `ggplot()`, `geom_point()` e `geom_smooth()` (dessa vez sem nenhum ajuste de modelo).\n\n```{r}\nexp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F)\n```\n\nPode-se observar pelo gráfico que a linha de tendência se assemelha a uma reta (modelo linear).\n\nPara ajustar os dados em um modelo linear, foi usada a função `lm()`.\n\n```{r}\nlm1 <- lm(nplants ~ trat,\n          data = exp1)\nsummary(lm1)\n```\n\nA partir da função `summary()`, é possível inferir que a taxa de redução da variável resposta em função do eixo X é de -0.24, ou seja, para cada unidade de X reduz o Y em -0.24.\n\nAlém disso, o p-valor é informado, sendo igual a 0.2066, ou seja, é superior ao nível de significância e não se pode rejeitar a hipótese nula (Ho: a taxa de redução é igual a 0).\n\nOutra alternativa para realizar a regressão linear é usando a função `glm()` e o argumento `family = \"gaussian\"`.\n\n```{r}\nglm1 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp1)\nsummary(glm1)\n```\n\nA família gaussiana envolve o mesmo método do \"lm\", resultando na mesma taxa de redução.\n\n## Regressão linear do experimento 2\n\nInicialmente foi filtrado apenas o experimento 2 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp2 <- estande |> \n  filter (exp == 2)\n```\n\nO mesmo gráfico foi montado para o experimento 2.\n\n```{r}\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = F)\n```\n\nPelo gráfico é possível observar uma diminuição dos valores de Y em função do eixo X.\n\n```{r}\nlm2 <- lm(nplants ~ trat,\n          data = exp2)\nsummary(lm2)\n```\n\nO resultado do modelo linear indica que a taxa de redução desses dados é de -0.70, ou seja, para cada unidade de X reduz o Y em -0.70.\n\nNesse experimento nota-se que o p-valor foi inferior ao nível de significância, indicando que a hipótese nula de que a taxa de redução é igual a 0 é rejeitada, ou seja, há uma regressão.\n\nAjustando o modelo pelo método do GLM, pode ser utilizado duas famílias: `family = \"gaussian\"` e `family = \"log\"`.\n\n```{r}\nglm2 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp2)\nsummary(glm2)\nAIC(glm2)\n\nglm2b <- glm(nplants ~ trat,\n             family = poisson(link = \"log\"),\n             data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n```\n\nA função `AIC()` compara os dois métodos (famílias diferentes) e fornece qual deles melhor representa o conjunto de dados. Sempre o menor valor é o mais recomendado. Nesse caso, usando a família gaussiana, o valor de AIC foi menor, sendo o modelo que melhor representa os dados.\n\n## Regressão linear do experimento 3\n\nInicialmente foi filtrado apenas o experimento 3 do conjunto de dados usando a função `filter()`.\n\n```{r}\nexp3 <- estande |> \n  filter (exp == 3)\n```\n\nO mesmo gráfico foi montado para o experimento 3.\n\n```{r}\nexp3 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = F)\n```\n\nPelo gráfico é possível observar uma diminuição dos valores de Y em função do eixo X.\n\n```{r}\nlm3 <- lm(nplants ~ trat,\n          data = exp3)\nsummary(lm3)\n```\n\nO resultado do modelo linear indica que a taxa de redução desses dados é de -0.76, ou seja, para cada unidade de X reduz o Y em -0.76.\n\nNesse experimento nota-se que o p-valor foi inferior ao nível de significância, indicando que a hipótese nula de que a taxa de redução é igual a 0 é rejeitada, ou seja, há uma regressão.\n\nO coeficiente de determinação (adjusted R-squared) fornecido é igual a 59%, o que indica que 59% da variabilidade do Y (número de plantas) é explicado pelo X (inóculo), sendo o máximo desse coeficiente igual a 1.\n\n```{r}\nglm3 <- glm(nplants ~ trat,\n            family = \"gaussian\",\n            data = exp3)\nsummary(glm3)\nAIC(glm3)\n\nglm3b <- glm(nplants ~ trat,\n             family = poisson(link = \"log\"),\n             data = exp3)\nsummary(glm3b)\nAIC(glm3b) #melhor qualidade de ajuste, quanto menor é melhor (mais ajustado)\n```\n\nPara esse conjunto de dados, a família log resultou em um menor valor de AIC, o que indica que esse modelo melhor representa os dados que a família gaussiana.\n\nTransformando o log dos tratamentos, os dados ficam mais linearizados (diminui a curva).\n\n```{r}\nexp3 |> \n  ggplot(aes(log(trat), nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F)\n```\n\n## Regressão linear geral\n\nPegandos os dados inteiros, foi realizado o ajuste do modelo usando o GLM tanto com a família gaussianda quanto por log e depois foi comparado os dois modelos com o AIC.\n\n```{r}\nlibrary(lme4)\nglm4 <- glmer(nplants ~ trat + (trat|exp),\n            family = \"gaussian\",\n            data = estande)\nsummary(glm4)\nAIC(glm4)\n\nglm4b <- glmer(nplants ~ trat + (trat|exp),   #(trat|exp) é o efeito aleatório\n             family = poisson(link = \"log\"),\n             data = estande)\nsummary(glm4b)\nAIC(glm4b)\n```\n\nUsando a família gaussianda, nota-se que o AIC obtido foi menor, indicando que, no geral, esse modelo é o que melhor representa o conjunto de dados.\n\n# Regressão linear - conjunto de dados 2\n\nPara uma nova regressão linear, um novo conjunto de dados foi importado a partir do pacote `r4pde`. O conjunto de dados é denominado de WhiteMoldSoybean.\n\nA regressão linear será usada para prever a produtividade da soja em função da incidência do mofo branco.\n\n```{r}\nlibrary(r4pde)\n\nwm <- WhiteMoldSoybean\n```\n\n## Visualização dos dados\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld, group = factor(study)))+\n  geom_point()+\n  facet_wrap(~ study)+\n  geom_smooth(method = \"lm\", se = F)+\n  theme_minimal()\n```\n\n## Regressão linear\n\n```{r}\nmofo1 <- lm(yld ~ inc,\n            data = wm)\nsummary(mofo1)\n```\n\nAjustando o conjunto de dados ao modelo linear, foi obtido uma taxa de redução de -9.261.\n\n```{r}\nlibrary(broom)\nmofo2 <- wm |> \n  group_by(study) |> \n  do(tidy(lm(.$yld ~ .$inc), conf.int = TRUE))\n\ndf<- mofo2 |> \n  filter(term == \".$inc\")\nmean(df$estimate)\n\n#Histograma da produtividade quando incidência é 0\np1 <- mofo2 |> \n  filter(term == \"(Intercept)\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Intercept\", y = \"frequency\")\np2 <- mofo2 |> \n  filter(term == \".$inc\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Slopes\", y = \"frequency\")\nlibrary(patchwork)\np1+p2\n```\n\nUm outro ajuste de modelo foi utilizado para o conjunto de dados, considerando desa vez um efeito aleatório de incidência por estudos.\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld ~ inc + (inc|study), data = wm, REML = F)\nsummary(mofo3)\n```\nEsta estimativa de taxa de redução de -17 é muito mais confiável, uma vez que os outros métodos subestimam os valores.\n\nA incidência está causando uma redução na produtividade de -17kg (à medida que a incidência aumenta, a produtividade diminui em 17kg)\n\n```{r}\nAnova(mofo3)\nconfint(mofo3, method = \"Wald\")\n```\n\n# Regressão quadrática\n\nA regressão quadrática é usada em modelos quadráticos, ou seja, modelos de segundo grau. Ao invés de regressões lineares, esses modelos formam regressões curvi-lineares.\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\nA partir do gráfico importado, foi filtrado apenas o experimento 2 para realizar a regressão quadrática.\n\n```{r}\nexp2 <- estande |> \n  filter (exp == 2)\n```\n\n## Visualização dos dados\n\nO gráfico montado apresenta tanto a linha de tendência ajustada no modelo linear quanto a linha de tendência ajustada no modelo quadrático, usando a função `geom_smooth()` e o argumento `formula = y ~poly(x,2)`.\n\n```{r}\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method = lm, se = FALSE,\n              formula = y ~poly(x,2))+ #Modelo quadrático\n  geom_smooth(method = lm, se = F, color = \"red\") #Modelo linear\n```\n\n## Regressão\n\nPara comparar qual é o melhor ajuste de modelo que representa o conjunto de dados, foi realizado o modelo de primeira ordem e de segunda ordem e depois eles foram comparados usando a função `AIC()`.\n\n```{r}\nexp2$trat2 <- exp2$trat^2 #Foi elevado ao quadrado para realizar o modelo quadrático, adicionar um coeficiente\n\n\n#Primeira ordem\nlm2 <- lm(nplants ~ trat,\n          data = exp2)\nsummary(lm2)\n\n#Segunda ordem ou quadrático\nlm3 <- lm(nplants ~ trat + trat2,\n          data = exp2)\nsummary(lm3) #R deu 0.49 --> explica melhor a variação dos dados se comparado ao de primeira ordem\n\nAIC(lm2)\nAIC(lm3)\n```\n\nPelo valor do AIC, observa-se que o modelo quadrático melhor representa o conjunto de dados.\n\nPara formular a função do modelo quadrático, é preciso observar os valores informados no `summary()`\n\n```{r}\nsummary(lm3)\n```\n\nA função do modelo quadrático é y = 66,3 - 1,77xtrat + 0,02xtrat^2\n\n## Usando o pacote AgroR\n\nAtravés do pacote `AgroR`, é possível criar os modelos de maneira mais fácil usando a função `polynomial()` e especificando o grau do modelo.\n\n```{r}\nlibrary(AgroR)\n\nwith(exp2, polynomial(trat, nplants, grau = 1))\n\nwith(exp2, polynomial(trat, nplants, grau = 2))\n\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\nNormalmente não se utiliza o modelo de grau 3, pois não dá para explicar biologicamente a razão do dado estar aumentando e diminuindo.\n\n# Regressão não-linear\n\nQuando não é possível ajustar o conjunto de dados em um modelo linear ou quadrático, tem-se a regressão não-linear.\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n```\n\nO conjunto de dados importado acima tem duas replicatas para cada nível de fator, para que facilite a sua análise, será agrupado as replicatas em um único dado, pegando a média deles.\n\n```{r}\npyra2 <- pyra |> \n  group_by(code, state, dose) |> \n  summarise(mean_germination = mean(germination))\n``` \n\n## Visualização dos dados\n\n```{r}\npyra2 |> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  geom_smooth(span = 3, se = FALSE)+\n  facet_wrap(~code)\n```\n\nNota-se que o conjunto de dados não segue o modelo linear e nem o modelo quadrático.\n\n## Calculando EC50 (redução da germinação em 50%)\n\nComo o conjunto de dados envolve a aplicação de produto em diferentes doses para o controle de germinação do fungo, é possível calcular o EC50, ou seja, a dose em que a redução da germinação é de 50%. Para isso foi usado o pacote `drc` e a função `ED()`. Todavia, antes de se calcular a EC50, é preciso ajustar o conjunto de dados em um modelo não-linear, usando a função `drm()` e o argumento `fct = LL.3()` (log-logistic de 3 parâmetros).\n\n```{r}\nlibrary(drc)\n\nisolado165 <- pyra2 |> \n  filter(code == \"165\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado165,\n            fct = LL.3())\nAIC(drc1) \nplot(drc1) #Para visualizar se o ajuste está bom\nED(drc1, 50, interval = \"delta\") #O interval = delta fornece o intervalo de confiança\n```\n\nPara o isolado 165, estima-se o EC50 no valor de dose 0.55\n\nÉ possível estimar o EC50 de mais de um isolado ao mesmo tempo usando o pacote `ec50estimator` e a função `estimate_EC50()`. Novamente foi usado o argumento `fct = drc::LL.3()`.\n\n```{r}\nlibrary(ec50estimator)\n\ndf_ec50 <- estimate_EC50(mean_germination ~ dose,\n                         data = pyra2,\n                         isolate_col = \"code\",\n                         interval = \"delta\",\n                         fct = drc::LL.3())\ndf_ec50\n```\n\nPode-se também criar um gráfico que permite visualizar quais isolados são mais sensíveis e quais são menos sensíveis ao produto.\n\n```{r}\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  geom_errorbar(aes(ymin = Lower, ymax = Upper))+\n  coord_flip()\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Aula9_quarto.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","editor":"visual","theme":{"light":"flatly","dark":"darkly"},"title":"Regressão","message":false},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}